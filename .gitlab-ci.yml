image: "python:3"

services:
    - mysql

variables:
    MYSQL_DATABASE: "auth_test"
    MYSQL_ALLOW_EMPTY_PASSWORD: "yes"
    MYSQL_HOST: "mysql"

stages:
    - test
    - upload

job1:
    stage: test
    script:
        - python3 setup.py test

job2:
    stage: upload
    script:
        - pip install twine wheel babel
        - python3 setup.py compile_catalog -d pammysqltools/locales
        - python3 setup.py sdist bdist_wheel
        - twine upload -u "$PYPI_USERNAME" -p "$PYPI_PASSWORD" dist/*
    only:
        - tags
